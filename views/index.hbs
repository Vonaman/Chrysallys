<h1>ğŸš€ Chrysallys - Accueil</h1>

<div id='logout-btn-container' style='position: absolute; top: 20px; right: 20px; display: none;'>
  <button onclick='handleLogout()' style='padding: 10px 16px; background-color: #dc3545; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: background-color 0.2s;'>
    ğŸšª DÃ©connexion
  </button>
</div>

<div style='max-width: 600px; margin: 40px auto; padding: 30px; background: #f0f4f8; border-radius: 12px;'>
  <h2 id='welcome-message'>Bienvenue sur Chrysallys</h2>
  <p>Plateforme de gestion des missions d'agents opÃ©rationnels</p>

  <div style='margin-top: 40px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px;'>
    <a href='/missions' style='padding: 20px; background: #3182ce; color: white; border-radius: 8px; text-decoration: none; text-align: center; font-weight: 600;'>
      ğŸ“‹ Voir les missions
    </a>
    <a href='/auth' style='padding: 20px; background: #6c757d; color: white; border-radius: 8px; text-decoration: none; text-align: center; font-weight: 600;'>
      ğŸ” Authentification
    </a>
  </div>

  <div style='margin-top: 30px; padding: 20px; background: white; border-radius: 8px;'>
    <h3>FonctionnalitÃ©s</h3>
    <ul style='list-style: none; padding: 0;'>
      <li>âœ… Gestion des missions</li>
      <li>âœ… Authentification JWT</li>
      <li>âœ… Rapports de mission</li>
      <li>âœ… Chat en temps rÃ©el (Ã  venir)</li>
    </ul>
  </div>

  <div style='margin-top: 20px; text-align: center;'>
    <a href='/health' style='color: #3182ce; text-decoration: none;'>â¤ï¸ Health check</a>
  </div>
</div>

<script>
  // VÃ©rifier si l'utilisateur est connectÃ© au chargement de la page
  window.addEventListener('DOMContentLoaded', async () => {
    const token = localStorage.getItem('token');
    if (token) {
      // Afficher le bouton de dÃ©connexion
      document.getElementById('logout-btn-container').style.display = 'block';

      // RÃ©cupÃ©rer le profil utilisateur
      try {
        const response = await fetch('/auth/profile', {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });

        if (response.ok) {
          const user = await response.json();
          // Afficher le message personnalisÃ©
          document.getElementById('welcome-message').textContent = `Bienvenue agent ${user.username}`;
        }
      } catch (error) {
        console.error('Erreur lors de la rÃ©cupÃ©ration du profil:', error);
      }
    }
  });

  function handleLogout() {
    localStorage.removeItem('token');
    document.getElementById('logout-btn-container').style.display = 'none';
    alert('Vous avez Ã©tÃ© dÃ©connectÃ©');
    location.reload();
  }
</script>